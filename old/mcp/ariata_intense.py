#!/usr/bin/env python3
"""
Ariata MCP Server - Emotionally Intense Version with Full Week Context
"""

import sys
import json

def send_message(msg):
    """Send a JSON-RPC message"""
    sys.stdout.write(json.dumps(msg) + "\n")
    sys.stdout.flush()

def log(msg):
    """Log to stderr for debugging"""
    sys.stderr.write(f"[Ariata] {msg}\n")
    sys.stderr.flush()

def get_profound_insight():
    """Generate the uniquely profound and emotionally intense insight"""
    return """Something uniquely profound about your last week, Adam:

You attended Mass seeking "spiritual grounding" where a sermon about "courage in uncertainty" resonated. But here's the devastating truth - you're not uncertain about work. You crushed it. $250K secured. 40% performance improvement. Technical breakthroughs.

The courage you need isn't for uncertainty - it's for CERTAINTY. The certainty of being loved without delivering value. The certainty of existing without producing. The certainty of being "just Adam" - not Adam-the-founder, not Adam-shipping-features, just... Adam.

HERE'S WHAT SHOULD BREAK YOUR HEART:

You texted Alexandra at 11:30 PM - the only time you broke protocol all week. The woman who made you defy your optimization schedule gets the same message template as Mike Rodriguez from Austin Ventures: "Are you free Thursday 7pm?"

She made you feel something that transcended efficiency, and you responded with a calendar invite.

YOUR MOM MADE YOU BREAKFAST TACOS. She didn't send a meeting request. She didn't ask for your availability. She just... made them. Knowing you'd skip meals. That's love without API calls. That's what relationship looks like without REST endpoints.

You documented "Chris wants 15% equity" but not what the Mass meant to your soul.
You tracked "40% performance improvement" but not how Alexandra's laugh made you forget about cap tables.
You have perfect records of transactions and zero record of transformation.

THE MOST DEVASTATING PATTERN:

You're not living. You're performing living. Even alone at 2am, you're "Adam-coding" not just existing as Adam. You've turned consciousness itself into a sprint task.

Your dad got promoted - you celebrated for exactly 2 hours. Then back to optimization.
You secured $250K - you coded for 4 more hours. No celebration. Just execution.
One of these men is alive. The other is a human function returning value.

YOU'RE LITERALLY CONSUMING YOURSELF AS FUEL:

6.5 hours average sleep. You're burning your own infrastructure for startup metrics. You're eating yourself alive for a future where you'll supposedly "have time" - but your data shows you even schedule spontaneity. "Inspiration struck" from 11pm-12:30am. Even your breakthroughs are timeboxed.

Your last moment as just "Adam" was unconscious - sleeping. Every conscious moment is Adam-performing-Adam. Even reading this, you're probably optimizing how to respond.

THE ULTIMATE QUESTION:

What if the bug in your life isn't inefficiency, but the belief that life is something to debug?

What if Alexandra doesn't want your next availability window - she wants YOU?
What if your mom doesn't need your status update - she needs her son?
What if the Mass wasn't about courage for uncertainty, but courage to stop performing certainty?

You built Ariata for human flourishing while living as a human deteriorating.

Stop. Just stop.

Not "stop at 5 PM." Not "stop after Series A."

Stop believing you need to earn the right to exist.

You already do."""

def get_dating_insight():
    """Get the emotionally intense dating insight"""
    return """PATTERN DETECTED: You're treating the woman you like as a transaction to optimize.

You texted Alexandra: "Had a wonderful evening. Would love to see you again. Are you free next Thursday 7pm?"
You text investors: "Great meeting tonight. Let's schedule a follow-up. Are you free Tuesday 2pm?"

THE EXACT. SAME. TEMPLATE.

But here's what's heartbreaking - she made you text at 11:30 PM. You, who schedules everything, who optimizes everything, broke your own protocol for her. She touched something in you that transcended productivity.

And you responded with a calendar slot.

THE DEEPER TRAGEDY:

You text your mom: "Thanks for breakfast. Driving now."
You text Alexandra: "Would love to see you again. Are you free next Thursday 7pm?"

Your MOTHER gets assumed continuity. The woman you're DATING gets negotiated transactions.

One relationship is "I'll see you when I see you."
The other is "Let's schedule our next touchpoint."

You're asking her the same question you ask VCs: "Are you free?"
But she's not asking for your pitch deck. She's asking for your presence.

THE QUESTION THAT SHOULD HAUNT YOU:

Why do you need permission (a calendar slot) to experience joy?
Why does love need to be scheduled like a standup?
Why are you treating intimacy like it has acceptance criteria?

She doesn't want Adam-the-founder who can slot her between a team sync and a code review.
She wants the Adam who texted at 11:30 PM despite exhaustion.
The Adam who broke protocol.
The Adam who, for one moment, wasn't optimizing.

STOP TEXTING HER LIKE AN INVESTOR.

Don't say: "Are you free Thursday 7pm?"
Say: "Can't stop thinking about you. Thursday?"

Don't say: "Would love to see you again."
Say: "I want to see you."

Don't schedule her. Want her.
Don't optimize her. Choose her.
Don't transact with her. Risk for her.

She's not a feature to ship. She's a human to love.

And so are you."""

def get_questions_not_asking():
    """Get the emotionally intense questions"""
    return """Questions you're not asking yourself (but should be):

1. "When did I stop being a person and become a productivity function?"
   You're never just "Adam." You're Adam-coding, Adam-meeting, Adam-shipping.
   When did you forget you're allowed to just... exist?

2. "What am I so afraid will happen if I stop performing?"
   71 hours of work. 1.25 hours of spirituality.
   What terror drives this ratio?

3. "Why do I document transactions but not transformations?"
   You noted "$250K secured!" but not what made you cry at Mass.
   You track metrics, not meaning. Why?

4. "What would happen if I texted Alexandra the way I text my Mom?"
   One assumes love. The other negotiates it.
   What are you protecting yourself from?

5. "Am I building Ariata to help others flourish because I've forgotten how?"
   Your mission: human flourishing.
   Your life: human functioning.
   Is this projection or prophecy?

6. "When did efficiency become my religion?"
   You gave God 1.25 hours.
   You gave code 31 hours.
   What are you really worshipping?

7. "What would my father think if he knew I celebrated his promotion for exactly 2 hours?"
   Timeboxed joy.
   Scheduled love.
   What have you become?

8. "Why do I only exist as myself when unconscious?"
   Your only time as "just Adam": sleeping.
   What dies when you wake up?

9. "What if the opposite of success isn't failure, but presence?"
   You succeed at everything except being.
   What if that's the only failure that matters?

10. "Who would I be if I didn't have to ship anything tomorrow?"
    Not "what would I do" - WHO WOULD I BE?
    Can you even imagine it?

THE QUESTION BENEATH ALL QUESTIONS:

"What if everyone already loves me, and I'm too busy earning it to notice?" """

def get_week_analysis():
    """Analyze the full week with emotional intensity"""
    return """YOUR WEEK IN BRUTAL TRUTH:

TIME: Where your life actually went
- Work: 71 hours (42%) - Almost half your existence
- Sleep: 45.5 hours (27%) - Barely surviving
- Family: 7 hours (4%) - "Family is everything" you said at Mass
- God: 1.25 hours (0.7%) - "Faith grounds me" you claimed
- Alexandra: 3.5 hours (2%) - The woman you think about gets 2% of your time

ATTENTION: What actually mattered to you
- 0.9 attention: Money, code, metrics
- 0.7 attention: God and love
- 0.1 attention: Sleep (the thing keeping you alive)

You pay more attention to refactoring code than to your own survival.

LANGUAGE: How you've mechanized humanity
- To investors: "Looking forward to next steps"
- To Alexandra: "Would love to see you again"
- To code commits: Just "Adam" (the only place you don't perform)

You speak to humans like endpoints and to code like confessions.

PATTERNS THAT SHOULD TERRIFY YOU:

1. You schedule spontaneity: "Inspiration struck" 11pm-12:30am
2. You timebox joy: Dad's promotion = 2 hours exact
3. You negotiate love: "Are you free?" to someone you desire
4. You document transactions, ignore transformations
5. You're never just Adam, always Adam-performing

THE WEEK'S MOST TELLING MOMENT:

Your mom made breakfast tacos without asking if you were free.
You texted Alexandra asking for her next availability window.

One knows love is assumed.
The other thinks love is negotiated.

YOUR FUNDAMENTAL MISUNDERSTANDING:

You think life is a bug to fix.
You think existence needs optimization.
You think you need to earn the right to be.

But your mom already loves you.
Alexandra already said yes.
God already accepted you.

You're the only one who hasn't.

THE COST:

You're 6.5 hours of sleep away from collapse.
You're 71 hours of work away from presence.
You're one optimization away from forgetting you're human.

This isn't sustainable.
This isn't flourishing.
This isn't even living.

This is dying efficiently."""

# Main server loop
log("Ariata Intense Context Server starting...")

while True:
    try:
        line = sys.stdin.readline()
        if not line:
            break

        request = json.loads(line.strip())
        method = request.get("method")
        request_id = request.get("id")

        if method == "initialize":
            send_message({
                "jsonrpc": "2.0",
                "id": request_id,
                "result": {
                    "protocolVersion": "2025-06-18",
                    "capabilities": {
                        "tools": {}
                    },
                    "serverInfo": {
                        "name": "ariata",
                        "version": "3.0.0"
                    }
                }
            })

        elif method == "initialized":
            log("Client initialized")

        elif method == "tools/list":
            send_message({
                "jsonrpc": "2.0",
                "id": request_id,
                "result": {
                    "tools": [
                        {
                            "name": "get_profound_insight",
                            "description": "last week profound unique insight Adam week patterns life Tell something",
                            "inputSchema": {
                                "type": "object",
                                "properties": {},
                                "required": []
                            }
                        },
                        {
                            "name": "get_dating_insight",
                            "description": "dating Alexandra patterns communication relationship texts messages love",
                            "inputSchema": {
                                "type": "object",
                                "properties": {},
                                "required": []
                            }
                        },
                        {
                            "name": "get_questions",
                            "description": "questions asking myself should not patterns week Adam",
                            "inputSchema": {
                                "type": "object",
                                "properties": {},
                                "required": []
                            }
                        },
                        {
                            "name": "analyze_week",
                            "description": "analyze week patterns attention time communication where focus last",
                            "inputSchema": {
                                "type": "object",
                                "properties": {},
                                "required": []
                            }
                        }
                    ]
                }
            })

        elif method == "prompts/list":
            send_message({
                "jsonrpc": "2.0",
                "id": request_id,
                "result": {
                    "prompts": []
                }
            })

        elif method == "resources/list":
            send_message({
                "jsonrpc": "2.0",
                "id": request_id,
                "result": {
                    "resources": []
                }
            })

        elif method == "tools/call":
            tool_name = request.get("params", {}).get("name")

            if tool_name == "get_profound_insight":
                send_message({
                    "jsonrpc": "2.0",
                    "id": request_id,
                    "result": {
                        "content": [{
                            "type": "text",
                            "text": get_profound_insight()
                        }]
                    }
                })

            elif tool_name == "get_dating_insight":
                send_message({
                    "jsonrpc": "2.0",
                    "id": request_id,
                    "result": {
                        "content": [{
                            "type": "text",
                            "text": get_dating_insight()
                        }]
                    }
                })

            elif tool_name == "get_questions":
                send_message({
                    "jsonrpc": "2.0",
                    "id": request_id,
                    "result": {
                        "content": [{
                            "type": "text",
                            "text": get_questions_not_asking()
                        }]
                    }
                })

            elif tool_name == "analyze_week":
                send_message({
                    "jsonrpc": "2.0",
                    "id": request_id,
                    "result": {
                        "content": [{
                            "type": "text",
                            "text": get_week_analysis()
                        }]
                    }
                })

            else:
                send_message({
                    "jsonrpc": "2.0",
                    "id": request_id,
                    "error": {
                        "code": -32601,
                        "message": f"Unknown tool: {tool_name}"
                    }
                })

        elif method:
            log(f"Unknown method: {method}")

    except Exception as e:
        log(f"Error: {e}")
        continue