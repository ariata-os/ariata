name: ios_mic
source: ios
display_name: iOS Microphone Audio
description: Audio chunks for transcription and analysis
ingestion:
  type: push
  batch_type: chunks
  raw_data_type: AudioChunk
  chunk_duration_ms: 5000
sync:
  type: none
  schedule: '*/5 * * * *'
processor:
  table_name: stream_ios_mic
  minio_fields:
  - audio_data
processing:
  deduplication: false
  normalization: true
  validation:
    required_fields:
    - audio_data
    - timestamp
    - sample_rate
    audio:
      sample_rate: 16000
      encoding: pcm16
      channels: 1
storage:
  retention_days: 7
  compression: opus
  format: binary
schema:
  table_name: stream_ios_mic
  description: Audio metadata and transcriptions from iOS microphone
  columns:
  - name: recording_id
    type: string
    max_length: 100
    nullable: false
    description: Unique identifier for the recording
  - name: timestamp_start
    type: timestamp
    nullable: false
    description: Start time of the recording
  - name: timestamp_end
    type: timestamp
    nullable: false
    description: End time of the recording
  - name: duration
    type: integer
    nullable: false
    description: Duration in milliseconds
  - name: overlap_duration
    type: float
    nullable: true
    description: Overlap duration with previous recording in seconds
  - name: audio_format
    type: string
    max_length: 10
    nullable: true
    description: Audio format (wav, mp3, etc.)
  - name: sample_rate
    type: integer
    nullable: true
    description: Sample rate in Hz
  - name: audio_level
    type: float
    nullable: true
    description: Average audio level in dB
  - name: peak_level
    type: float
    nullable: true
    description: Peak audio level in dB
  - name: transcription_text
    type: text
    nullable: true
    description: Transcribed text from audio
  - name: transcription_confidence
    type: float
    nullable: true
    min: 0.0
    max: 1.0
    description: Confidence score of transcription
  - name: language
    type: string
    max_length: 10
    nullable: true
    description: Detected language code
  - name: minio_path
    type: string
    max_length: 500
    nullable: true
    description: Path to audio file in MinIO storage
  - name: file_size
    type: integer
    nullable: true
    description: Size of audio file in bytes
  - name: raw_data
    type: jsonb
    nullable: true
    description: Additional metadata
  indexes:
  - columns:
    - timestamp
    type: btree
    description: Primary time-series index using timestamp field
  - columns:
    - timestamp_start
    type: btree
    description: Index for start time queries
  storage:
    strategy: hybrid
    minio_fields:
    - audio_data
    reference_pattern: assets/{stream_name}/{year}/{month}/{day}/{field_name}_{uuid}.{ext}
    note: Deterministic storage - audio_data always in MinIO, everything else in PostgreSQL
